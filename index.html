
<!-- Ajout dans le HTML : Nouvel √©cran pour les d√©tails -->
<div class="screen" id="detail-screen">
    <div class="app-header">
        <div style="display: flex; align-items: center; gap: 12px;">
            <button onclick="goBack()" style="background: none; border: none; color: white; font-size: 20px; cursor: pointer;">‚Üê</button>
            <div>
                <div class="app-title" id="detail-title">D√©tails de la plante</div>
                <div class="app-subtitle" id="detail-subtitle">Chargement...</div>
            </div>
        </div>
    </div>

    <div class="main-content">
        <div class="loading" id="detail-loading">
            <div class="loading-spinner"></div>
            <div>Chargement des d√©tails...</div>
        </div>
        
        <div id="detail-content" style="display: none;">
            <!-- Image principale -->
            <div class="detail-image" id="detail-image">
                <div class="plant-image" style="width: 100%; height: 200px; font-size: 48px;" id="detail-main-image">üåø</div>
            </div>
            
            <!-- Informations de base -->
            <div class="detail-section">
                <div class="detail-basic-info">
                    <h2 id="detail-nom-francais">Nom de la plante</h2>
                    <p id="detail-nom-latin" class="latin-name">Nom latin</p>
                    <div class="detail-tags" id="detail-tags"></div>
                </div>
            </div>
            
            <!-- Description -->
            <div class="detail-section">
                <h3 class="section-title">Description</h3>
                <p id="detail-description" class="section-content"></p>
            </div>
            
            <!-- Caract√©ristiques -->
            <div class="detail-section">
                <h3 class="section-title">Caract√©ristiques</h3>
                <div class="characteristics-grid" id="characteristics-grid"></div>
            </div>
            
            <!-- Formats et prix (si disponibles) -->
            <div class="detail-section" id="formats-section" style="display: none;">
                <h3 class="section-title">Formats disponibles</h3>
                <div id="formats-list"></div>
            </div>
            
            <!-- Boutons d'action -->
            <div class="detail-actions">
                <button class="action-btn primary" id="add-to-library-btn" onclick="addCurrentPlantToLibrary()">
                    Ajouter √† ma biblioth√®que
                </button>
                <button class="action-btn secondary" onclick="openOriginalUrl()" id="view-original-btn">
                    Voir sur le site
                </button>
            </div>
        </div>
    </div>
</div>

<!-- CSS suppl√©mentaire √† ajouter dans le <style> -->
<style>
.detail-image {
    background: white;
    border-bottom: 1px solid #e0e0e0;
}

.detail-section {
    background: white;
    margin: 12px 16px;
    padding: 16px;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
}

.detail-basic-info h2 {
    font-size: 20px;
    font-weight: 600;
    margin-bottom: 4px;
    color: #2E7D32;
}

.latin-name {
    font-style: italic;
    color: #666;
    margin-bottom: 12px;
}

.detail-tags {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
}

.detail-tag {
    background: #E8F5E8;
    color: #2E7D32;
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 12px;
}

.section-title {
    font-size: 16px;
    font-weight: 600;
    margin-bottom: 12px;
    color: #2E7D32;
}

.section-content {
    line-height: 1.5;
    color: #333;
}

.characteristics-grid {
    display: grid;
    gap: 12px;
}

.characteristic-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 0;
    border-bottom: 1px solid #f0f0f0;
}

.characteristic-item:last-child {
    border-bottom: none;
}

.characteristic-label {
    font-weight: 500;
    color: #666;
}

.characteristic-value {
    color: #333;
    text-align: right;
    flex: 1;
    margin-left: 12px;
}

.format-item {
    background: #f8f8f8;
    padding: 12px;
    border-radius: 8px;
    margin-bottom: 8px;
}

.format-name {
    font-weight: 500;
    margin-bottom: 4px;
}

.format-price {
    color: #4CAF50;
    font-weight: 600;
}

.detail-actions {
    position: fixed;
    bottom: 100px;
    left: 0;
    right: 0;
    padding: 16px;
    background: white;
    border-top: 1px solid #e0e0e0;
    display: flex;
    gap: 12px;
}

.action-btn {
    flex: 1;
    padding: 12px;
    border: none;
    border-radius: 8px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;
}

.action-btn.primary {
    background: #4CAF50;
    color: white;
}

.action-btn.primary:hover {
    background: #45a049;
}

.action-btn.secondary {
    background: #f5f5f5;
    color: #666;
    border: 1px solid #e0e0e0;
}

.action-btn.secondary:hover {
    background: #e8e8e8;
}

/* Mise √† jour des filtres */
.filter-chips {
    display: flex;
    gap: 8px;
    padding: 0 16px 16px;
    overflow-x: auto;
}

.chip {
    background: #e8f5e8;
    color: #2E7D32;
    padding: 6px 12px;
    border-radius: 16px;
    font-size: 12px;
    white-space: nowrap;
    border: 1px solid #4CAF50;
    cursor: pointer;
    transition: all 0.2s ease;
}

.chip.active {
    background: #4CAF50;
    color: white;
}

/* Boutons d√©tails dans les r√©sultats */
.result-actions {
    display: flex;
    gap: 8px;
}

.detail-btn {
    background: #f5f5f5;
    color: #666;
    border: 1px solid #e0e0e0;
    padding: 6px 12px;
    border-radius: 16px;
    font-size: 12px;
    cursor: pointer;
    transition: all 0.2s ease;
}

.detail-btn:hover {
    background: #e8e8e8;
}
</style>

<script>
// Variables globales pour la vue d√©taill√©e
let currentPlantDetail = null;
let previousScreen = 'home';

// Filtres mis √† jour avec nouvelles cat√©gories
const PLANT_CATEGORIES = [
    'Tous', 'Arbuste', 'Vivace', 'Arbre', 'Rosier', 
    'Succulente', 'Bulbe', 'Aromatique', 'Grimpante', 'Foug√®re'
];

// Mise √† jour des filtres dans le HTML au chargement
function updateFilterChips() {
    const filterContainer = document.querySelector('.filter-chips');
    filterContainer.innerHTML = PLANT_CATEGORIES.map(category => 
        `<div class="chip ${category === 'Tous' ? 'active' : ''}" data-type="${category}">${category}${category.endsWith('e') ? 's' : category === 'Tous' ? '' : 's'}</div>`
    ).join('');
    
    // R√©attacher les √©v√©nements
    document.querySelectorAll('.chip').forEach(chip => {
        chip.addEventListener('click', function() {
            document.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
            this.classList.add('active');
            currentFilter = this.dataset.type;
            filterResults();
        });
    });
}

// Fonction pour afficher les d√©tails d'une plante
async function showPlantDetail(plantData, fromScreen = 'search') {
    previousScreen = fromScreen;
    
    // Basculer vers l'√©cran d√©tail
    showScreen('detail');
    
    // Afficher le loading
    document.getElementById('detail-loading').style.display = 'block';
    document.getElementById('detail-content').style.display = 'none';
    
    try {
        let detailData;
        
        if (plantData.url && plantData.url.includes('promessedefleurs.com')) {
            // R√©cup√©rer les d√©tails complets depuis l'API
            const response = await fetch(`${API_URL}/plant/detail?url=${encodeURIComponent(plantData.url)}`);
            const result = await response.json();
            
            if (result.success) {
                detailData = result.data;
            } else {
                throw new Error('Impossible de r√©cup√©rer les d√©tails');
            }
        } else {
            // Utiliser les donn√©es de base
            detailData = plantData;
        }
        
        currentPlantDetail = detailData;
        displayPlantDetail(detailData);
        
    } catch (error) {
        console.error('Erreur chargement d√©tails:', error);
        // Afficher les donn√©es de base en cas d'erreur
        currentPlantDetail = plantData;
        displayPlantDetail(plantData);
    }
    
    document.getElementById('detail-loading').style.display = 'none';
    document.getElementById('detail-content').style.display = 'block';
}

// Afficher les d√©tails d'une plante
function displayPlantDetail(data) {
    // Titre et sous-titre
    document.getElementById('detail-title').textContent = data.nom_francais || data.nom_complet || 'Plante';
    document.getElementById('detail-subtitle').textContent = data.nom_latin || '';
    
    // Image principale
    const imageEl = document.getElementById('detail-main-image');
    if (data.image_principale) {
        imageEl.innerHTML = `<img src="${data.image_principale}" alt="${data.nom_francais}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 0;">`;
    } else {
        imageEl.textContent = data.icon || 'üåø';
    }
    
    // Informations de base
    document.getElementById('detail-nom-francais').textContent = data.nom_francais || data.nom_complet || 'Nom non disponible';
    document.getElementById('detail-nom-latin').textContent = data.nom_latin || '';
    
    // Tags
    const tagsContainer = document.getElementById('detail-tags');
    tagsContainer.innerHTML = '';
    
    const tags = [];
    if (data.type_plante) tags.push(data.type_plante);
    if (data.exposition) tags.push(data.exposition);
    if (data.rusticite) tags.push(data.rusticite);
    
    tags.forEach(tag => {
        const tagEl = document.createElement('span');
        tagEl.className = 'detail-tag';
        tagEl.textContent = tag;
        tagsContainer.appendChild(tagEl);
    });
    
    // Description
    const description = data.description_detaillee || data.description_courte || data.description || 'Aucune description disponible.';
    document.getElementById('detail-description').textContent = description;
    
    // Caract√©ristiques
    const characteristicsContainer = document.getElementById('characteristics-grid');
    characteristicsContainer.innerHTML = '';
    
    const characteristics = [
        { label: 'Exposition', value: data.exposition },
        { label: 'Hauteur √† maturit√©', value: data.hauteur_maturite },
        { label: 'Largeur √† maturit√©', value: data.largeur_maturite },
        { label: 'P√©riode de floraison', value: data.periode_floraison },
        { label: 'Couleur des fleurs', value: data.couleur_fleur },
        { label: 'Persistance du feuillage', value: data.persistance_feuillage },
        { label: 'Type de sol', value: data.type_sol },
        { label: 'pH du sol', value: data.ph_sol },
        { label: 'Rusticit√©', value: data.rusticite },
        { label: 'Origine', value: data.origine }
    ];
    
    characteristics.forEach(char => {
        if (char.value) {
            const charEl = document.createElement('div');
            charEl.className = 'characteristic-item';
            charEl.innerHTML = `
                <span class="characteristic-label">${char.label}</span>
                <span class="characteristic-value">${char.value}</span>
            `;
            characteristicsContainer.appendChild(charEl);
        }
    });
    
    // Formats (si disponibles)
    const formatsSection = document.getElementById('formats-section');
    const formatsList = document.getElementById('formats-list');
    
    if (data.formats && data.formats.length > 0) {
        formatsSection.style.display = 'block';
        formatsList.innerHTML = '';
        
        data.formats.forEach(format => {
            const formatEl = document.createElement('div');
            formatEl.className = 'format-item';
            formatEl.innerHTML = `
                <div class="format-name">${format.format || 'Format non sp√©cifi√©'}</div>
                <div class="format-price">${format.prix_unitaire ? format.prix_unitaire + ' ‚Ç¨' : 'Prix non disponible'}</div>
            `;
            formatsList.appendChild(formatEl);
        });
    } else {
        formatsSection.style.display = 'none';
    }
    
    // Bouton voir sur le site
    const viewOriginalBtn = document.getElementById('view-original-btn');
    if (data.url) {
        viewOriginalBtn.style.display = 'block';
        viewOriginalBtn.onclick = () => window.open(data.url, '_blank');
    } else {
        viewOriginalBtn.style.display = 'none';
    }
}

// Fonction pour retourner √† l'√©cran pr√©c√©dent
function goBack() {
    showScreen(previousScreen);
}

// Ajouter la plante actuelle √† la biblioth√®que
async function addCurrentPlantToLibrary() {
    if (!currentPlantDetail) return;
    
    const button = document.getElementById('add-to-library-btn');
    const originalText = button.textContent;
    button.textContent = '‚úì Ajout...';
    button.disabled = true;
    
    try {
        const response = await fetch(`${API_URL}/library/add`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                plant: currentPlantDetail,
                notes: '',
                quantity: 1
            })
        });
        
        if (response.ok) {
            button.textContent = '‚úì Ajout√© !';
            setTimeout(() => {
                button.textContent = originalText;
                button.disabled = false;
            }, 2000);
            
            // Recharger les stats
            loadStats();
            loadRecentPlants();
        } else {
            throw new Error('Erreur lors de l\'ajout');
        }
    } catch (error) {
        console.error('Erreur ajout plante:', error);
        button.textContent = originalText;
        button.disabled = false;
        alert('Erreur lors de l\'ajout √† la biblioth√®que.');
    }
}

// Mise √† jour de la fonction createSearchResultElement pour ajouter le bouton d√©tail
function createSearchResultElement(plant) {
    const plantEl = document.createElement('div');
    plantEl.className = 'search-suggestion';
    plantEl.dataset.type = plant.type_plante || 'Plante';
    
    plantEl.innerHTML = `
        <div class="suggestion-icon">${plant.icon || 'üåø'}</div>
        <div class="suggestion-info">
            <div class="suggestion-name">${plant.nom_francais}</div>
            <div class="suggestion-latin">${plant.nom_latin}</div>
        </div>
        <div class="result-actions">
            <button class="detail-btn" onclick="event.stopPropagation(); showPlantDetail(${escapeQuotes(JSON.stringify(plant))}, 'search')">D√©tails</button>
            <button class="add-btn" onclick="addToLibrary(event, ${escapeQuotes(JSON.stringify(plant))})">Ajouter</button>
        </div>
    `;
    
    return plantEl;
}

// Mise √† jour de la fonction pour la biblioth√®que
function createLibraryCardElement(item) {
    const plant = item.plant;
    const cardEl = document.createElement('div');
    cardEl.className = 'library-card';
    cardEl.innerHTML = `
        <div class="library-card-image">${plant.icon || 'üåø'}</div>
        <div class="library-card-content">
            <div class="library-card-name">${plant.nom_francais}</div>
            <div class="library-card-details">${item.quantity || 1} plant${(item.quantity || 1) > 1 ? 's' : ''} ‚Ä¢ ${plant.prix || 'Prix non sp√©cifi√©'}</div>
        </div>
    `;
    
    // Ajouter l'√©v√©nement click pour afficher les d√©tails
    cardEl.onclick = () => showPlantDetail(plant, 'library');
    
    return cardEl;
}

// Initialisation avec les nouveaux filtres
document.addEventListener('DOMContentLoaded', function() {
    // ... code existant ...
    updateFilterChips();
    
    // Ajouter la gestion du bouton retour navigateur
    window.addEventListener('popstate', function(event) {
        if (currentScreen === 'detail') {
            goBack();
        }
    });
});
</script>
